<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Inventory App</title>

<style>
body{font-family:Arial;background:#f4f6f8;padding:15px}
.search{width:100%;padding:10px;font-size:16px;margin-bottom:15px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:15px}
.card{background:#fff;padding:12px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.card img{width:100%;height:160px;object-fit:cover;border-radius:6px}
.badge{background:#eee;padding:2px 8px;border-radius:12px;font-size:12px;margin-right:4px}
.actions{display:flex;gap:6px;margin-top:8px}
button{padding:6px;border:none;border-radius:5px;cursor:pointer}
.in{background:#e8f5e9}
.out{background:#ffebee}
.edit{background:#e3f2fd}
.del{background:#fce4ec}
.low{color:red;font-weight:bold}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);justify-content:center;align-items:center}
.modal-box{background:#fff;padding:15px;width:90%;max-width:400px;border-radius:8px}
.modal-box input{width:100%;padding:8px;margin-bottom:8px}
</style>
</head>

<body>

<h2>Inventory</h2>
<input class="search" placeholder="Search..." oninput="search(this.value)">
<div id="list" class="grid"></div>

<!-- EDIT MODAL -->
<div id="editModal" class="modal">
  <div class="modal-box">
    <h3>Edit Product</h3>
    <input id="e_name">
    <input id="e_color">
    <input id="e_size">
    <input id="e_bin">
    <input id="e_price" type="number">
    <button class="edit" onclick="saveEdit()">Save</button>
    <button onclick="closeEdit()">Cancel</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, getDocs, doc, updateDoc,
  deleteDoc, addDoc, increment, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ðŸ”‘ PASTE YOUR FIREBASE CONFIG HERE */
const firebaseConfig = {
  apiKey: "AIzaSyAMOEoWseBnscSrmpnZ2u9U7tgtuwWHeh4",
  authDomain: "inventory-app-9f7a3.firebaseapp.com",
  projectId: "inventory-app-9f7a3"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let products = [];
let editId = null;

/* TEMP ROLE (replace with Auth later) */
localStorage.setItem("role","admin");

function isAdmin(){
  return localStorage.getItem("role")==="admin";
}

async function load(){
  const snap = await getDocs(collection(db,"inventory"));
  products = snap.docs.map(d=>({id:d.id,...d.data()}));
  render(products);
}
load();

function render(data){
  list.innerHTML="";
  data.forEach(p=>{
    list.innerHTML+=`
    <div class="card">
      <img src="${p.image||'https://via.placeholder.com/300'}">
      <h3>${p.name}</h3>
      <div>
        <span class="badge">${p.code}</span>
        <span class="badge">${p.color}</span>
        <span class="badge">${p.size}</span>
      </div>
      <div>Bin: ${p.bin}</div>
      <div class="${p.stock<5?'low':''}">Stock: ${p.stock}</div>
      <b>â‚¹${p.price}</b>

      <div class="actions">
        <button class="in" onclick="stock('${p.id}','${p.code}',1)">IN</button>
        <button class="out" onclick="stock('${p.id}','${p.code}',-1)">OUT</button>
      </div>

      ${isAdmin()?`
      <div class="actions">
        <button class="edit" onclick="edit('${p.id}')">Edit</button>
        <button class="del" onclick="remove('${p.id}','${p.code}')">Delete</button>
      </div>`:""}
    </div>`;
  });
}

window.search=q=>{
  q=q.toLowerCase();
  render(products.filter(p=>
    p.name.toLowerCase().includes(q)||
    p.code.toLowerCase().includes(q)||
    p.color.toLowerCase().includes(q)
  ));
}

window.stock=async(id,code,d)=>{
  const qty=+prompt("Qty?");
  if(!qty)return;
  await updateDoc(doc(db,"inventory",id),{stock:increment(d*qty)});
  await log(d>0?"STOCK_IN":"STOCK_OUT",code,qty);
  load();
}

window.edit=async(id)=>{
  editId=id;
  const p=products.find(x=>x.id===id);
  e_name.value=p.name;
  e_color.value=p.color;
  e_size.value=p.size;
  e_bin.value=p.bin;
  e_price.value=p.price;
  editModal.style.display="flex";
}

window.saveEdit=async()=>{
  await updateDoc(doc(db,"inventory",editId),{
    name:e_name.value,
    color:e_color.value,
    size:e_size.value,
    bin:e_bin.value,
    price:+e_price.value
  });
  await log("EDIT_PRODUCT",e_name.value,0);
  closeEdit(); load();
}

window.closeEdit=()=>editModal.style.display="none";

window.remove=async(id,code)=>{
  if(!confirm("Delete?"))return;
  await deleteDoc(doc(db,"inventory",id));
  await log("DELETE_PRODUCT",code,0);
  load();
}

async function log(action,code,qty){
  await addDoc(collection(db,"audit_logs"),{
    action,code,qty,
    staff:"admin",
    time:serverTimestamp()
  });
}
</script>
</body>
</html>

