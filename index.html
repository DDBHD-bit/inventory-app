<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Inventory App</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body { font-family: Arial; background:#f2f2f2; margin:0; padding:20px; }
button { padding:6px 12px; border:none; border-radius:6px; background:#007bff; color:white; cursor:pointer; }
button.red { background:#dc3545; }
input { padding:6px; width:100%; margin-bottom:8px; }

#loginBox {
  max-width:320px;
  margin:120px auto;
  background:white;
  padding:20px;
  border-radius:10px;
  box-shadow:0 4px 8px rgba(0,0,0,.2);
}

.card {
  background:white;
  padding:12px;
  margin-top:12px;
  border-radius:10px;
}

.modal {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.modalInner {
  background:white;
  padding:16px;
  width:320px;
  border-radius:10px;
}

.hidden { display:none; }
</style>
</head>
<body>

<!-- LOGIN ONLY -->
<div id="loginBox">
  <h3>Login</h3>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<script>
/* ================= FIREBASE ================= */
firebase.initializeApp({
  apiKey: "AIzaSyAMOEoWseBnscSrmpnZ2u9U7tgtuwWHeh4",
  authDomain: "inventory-app-9f7a3.firebaseapp.com",
  projectId: "inventory-app-9f7a3"
});

const auth = firebase.auth();
const db = firebase.firestore();

let openModal = null;

/* ================= LOGIN ================= */
function login(){
  auth.signInWithEmailAndPassword(email.value, password.value)
    .catch(e => alert(e.message));
}

/* ================= ESC KEY CLOSE ================= */
document.addEventListener("keydown", e => {
  if (e.key === "Escape" && openModal) {
    openModal.classList.add("hidden");
    openModal = null;
  }
});

/* ================= POST LOGIN ================= */
auth.onAuthStateChanged(user => {
  if (!user) return;

  document.getElementById("loginBox").remove();

  const appUI = document.createElement("div");
  document.body.appendChild(appUI);

  /* ===== HEADER ===== */
  appUI.innerHTML = `
    <h2>Inventory App</h2>
    <button id="addBtn">Add Product</button>
    <button id="auditBtn">Audit Logs</button>
    <button id="summaryBtn">Daily Summary</button>
    <button id="logoutBtn" class="red">Logout</button>
    <div id="results" class="card">Products will show here</div>
  `;

  /* ===== ADD PRODUCT MODAL ===== */
  const addModal = createModal(`
    <h3>Add Product</h3>
    <input placeholder="Code">
    <input placeholder="Name">
    <button id="closeAdd">Close</button>
  `);

  /* ===== AUDIT MODAL ===== */
  const auditModal = createModal(`
    <h3>Audit Logs</h3>
    <p>No logs yet</p>
    <button id="closeAudit">Close</button>
  `);

  /* ===== SUMMARY MODAL ===== */
  const summaryModal = createModal(`
    <h3>Daily Summary</h3>
    <p>No data</p>
    <button id="closeSummary">Close</button>
  `);

  /* ===== BUTTON EVENTS ===== */
  document.getElementById("addBtn").onclick = () => open(addModal);
  document.getElementById("auditBtn").onclick = () => open(auditModal);
  document.getElementById("summaryBtn").onclick = () => open(summaryModal);
  document.getElementById("logoutBtn").onclick = () => auth.signOut();

  document.getElementById("closeAdd").onclick = () => close(addModal);
  document.getElementById("closeAudit").onclick = () => close(auditModal);
  document.getElementById("closeSummary").onclick = () => close(summaryModal);
});

/* ================= MODAL HELPERS ================= */
function createModal(innerHTML){
  const m = document.createElement("div");
  m.className = "modal hidden";
  m.innerHTML = `<div class="modalInner">${innerHTML}</div>`;
  document.body.appendChild(m);

  // click outside closes
  m.onclick = e => {
    if (e.target === m) close(m);
  };

  return m;
}

function open(modal){
  modal.classList.remove("hidden");
  openModal = modal;
}

function close(modal){
  modal.classList.add("hidden");
  if (openModal === modal) openModal = null;
}
</script>

</body>
</html>

