<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Inventory App</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- QR -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

<style>
body{margin:0;font-family:Arial;background:#f1f5f9}
header{background:#1e40af;color:#fff;padding:12px 16px;display:flex;justify-content:space-between}
.container{padding:16px;max-width:900px;margin:auto}
.card{background:#fff;border-radius:12px;padding:14px;margin-bottom:14px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
input,button{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:1px solid #ccc}
button{background:#2563eb;color:#fff;border:none}
button.secondary{background:#64748b}
.hidden{display:none}
.product{display:flex;gap:12px}
.product img{width:80px;height:80px;border-radius:10px;object-fit:cover}
.actions button{width:auto;margin-right:6px}
.low{color:red;font-weight:bold}
</style>
</head>

<body>

<header>
Â  <b>Inventory</b>
Â  <button onclick="logout()">Logout</button>
</header>

<!-- LOGIN -->
<div class="container" id="loginBox">
Â  <div class="card">
Â Â Â  <h3>Login</h3>
Â Â Â  <input id="email" placeholder="Email">
Â Â Â  <input id="password" type="password" placeholder="Password">
Â Â Â  <button onclick="login()">Login</button>
Â  </div>
</div>

<!-- APP -->
<div class="container hidden" id="appBox">
Â  <input id="search" placeholder="Search..." oninput="loadProducts()">
Â  <button onclick="showAdd()">âž• Add Product</button>
Â  <div id="products"></div>
</div>

<!-- ADD PRODUCT -->
<div class="container hidden" id="addBox">
Â  <div class="card">
Â Â Â  <h3>Add Product</h3>
Â Â Â  <input id="pname" placeholder="Name">
Â Â Â  <input id="pcode" placeholder="Code">
Â Â Â  <input id="pcolor" placeholder="Color">
Â Â Â  <input id="psize" placeholder="Size">
Â Â Â  <input id="pprice" type="number" placeholder="Price">
Â Â Â  <input id="pstock" type="number" placeholder="Stock">
Â Â Â  <input type="file" id="pimage" accept="image/*" capture="environment">
Â Â Â  <button onclick="addProduct()">Save</button>
Â Â Â  <button class="secondary" onclick="hideAdd()">Cancel</button>
Â  </div>
</div>

<script>
// ðŸ” Firebase config
firebase.initializeApp({
Â  apiKey: "AIzaSyAMOEoWseBnscSrmpnZ2u9U7tgtuwWHeh4",
Â  authDomain: "inventory-app-9f7a3.firebaseapp.com",
Â  projectId: "inventory-app-9f7a3"
});

const auth = firebase.auth();
const db = firebase.firestore();

// â˜ï¸ Cloudinary
const CLOUD_NAME = "dahxnopuw";
const UPLOAD_PRESET = "inventory_unsigned";

// ðŸ” Auth
auth.onAuthStateChanged(u=>{
Â  loginBox.classList.toggle("hidden", !!u);
Â  appBox.classList.toggle("hidden", !u);
Â  if(u) loadProducts();
});

window.login = function(){
  auth.signInWithEmailAndPassword(email.value,password.value)
    .catch(e=>alert(e.message));
}

window.logout = function(){
  auth.signOut();
}


// ðŸ“· Image compression
function compressImage(file){
Â  return new Promise(resolve=>{
Â Â Â  const img=new Image();
Â Â Â  img.onload=()=>{
Â Â Â Â Â  const c=document.createElement("canvas");
Â Â Â Â Â  const max=800;
Â Â Â Â Â  let w=img.width,h=img.height;
Â Â Â Â Â  if(w>h && w>max){h*=max/w;w=max}
Â Â Â Â Â  else if(h>max){w*=max/h;h=max}
Â Â Â Â Â  c.width=w;c.height=h;
Â Â Â Â Â  c.getContext("2d").drawImage(img,0,0,w,h);
Â Â Â Â Â  c.toBlob(b=>resolve(b),"image/jpeg",0.7);
Â Â Â  };
Â Â Â  img.src=URL.createObjectURL(file);
Â  });
}

// â˜ï¸ Upload to Cloudinary
async function uploadToCloudinary(file){
Â  const blob=await compressImage(file);
Â  const fd=new FormData();
Â  fd.append("file",blob);
Â  fd.append("upload_preset",UPLOAD_PRESET);

Â  const res=await fetch(
Â Â Â  `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`,
Â Â Â  {method:"POST",body:fd}
Â  );
Â  const data=await res.json();
Â  return data.secure_url;
}

// âž• Add product
async function addProduct(){
Â  if(!pimage.files[0]) return alert("Image required");
Â  const imageUrl=await uploadToCloudinary(pimage.files[0]);

Â  await db.collection("inventory").add({
Â Â Â  name:pname.value,
Â Â Â  code:pcode.value,
Â Â Â  color:pcolor.value,
Â Â Â  size:psize.value,
Â Â Â  price:+pprice.value,
Â Â Â  stock:+pstock.value,
Â Â Â  image:imageUrl,
Â Â Â  createdAt:firebase.firestore.FieldValue.serverTimestamp()
Â  });

Â  hideAdd();
Â  loadProducts();
}

// ðŸ“¦ Load products
async function loadProducts(){
  products.innerHTML = "";
  const q = search.value.toLowerCase();

  const snap = await db.collection("inventory").get();
  const grouped = {};

  // 1ï¸âƒ£ GROUP DATA
  snap.forEach(doc => {
    const p = doc.data();
    const text = `${p.name} ${p.code} ${p.color} ${p.size}`.toLowerCase();
    if (q && !text.includes(q)) return;

    grouped[p.code] ??= {};
    grouped[p.code][p.color] ??= {
      image: p.image,
      name: p.name,
      sizes: []
    };

    grouped[p.code][p.color].sizes.push({
      id: doc.id,
      size: p.size,
      stock: p.stock,
      price: p.price
    });
  });

  if (Object.keys(grouped).length === 0) {
    products.innerHTML = `<div class="card">No products found</div>`;
    return;
  }

  // 2ï¸âƒ£ RENDER UI
  Object.keys(grouped).forEach(code => {
    const codeCard = document.createElement("div");
    codeCard.className = "card";
    codeCard.innerHTML = `<div class="group-title">Product Code: ${code}</div>`;

    Object.keys(grouped[code]).forEach(color => {
      const c = grouped[code][color];

      const colorBlock = document.createElement("div");
      colorBlock.className = "product sub";
      colorBlock.innerHTML = `
        <img src="${c.image}">
        <div>
          <b>${c.name}</b><br>
          Color: <b>${color}</b>
        </div>
      `;

      const sizeList = document.createElement("div");
      sizeList.className = "sub";

      c.sizes.forEach(s => {
        const row = document.createElement("div");
        row.innerHTML = `
          Size: <b>${s.size}</b> |
          â‚¹${s.price} |
          <span class="${s.stock < 5 ? 'low' : ''}">
            Stock: ${s.stock}
          </span>

<button type="button" onclick="updateStock('${s.id}',1)">IN</button>
<button type="button" onclick="updateStock('${s.id}',-1)">OUT</button>



          
        `;
        sizeList.appendChild(row);
      });

      codeCard.appendChild(colorBlock);
      codeCard.appendChild(sizeList);
    });

    products.appendChild(codeCard);
  });
}



async function updateStock(id,delta){
Â  const ref=db.collection("inventory").doc(id);
Â  const doc=await ref.get();
Â  await ref.update({stock:doc.data().stock+delta});
Â  loadProducts();
}

function showAdd(){ addBox.classList.remove("hidden"); }
function hideAdd(){ addBox.classList.add("hidden"); }
</script>

</body>
</html>



